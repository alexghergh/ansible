# Arch Linux
- name: Ensure pyenv is installed (Archlinux).
  pacman:
    name: "pyenv"
    state: latest
  when: ansible_distribution == "Archlinux"

# Ubuntu / Debian
- name: Ensure pyenv dependencies are installed (Ubuntu / Debian).
  apt:
    name: [ "make", "build-essential", "libssl-dev", "zlib1g-dev", "libbz2-dev", "libreadline-dev", "libsqlite3-dev", "wget", "curl", "llvm", "libncursesw5-dev", "xz-utils", "tk-dev", "libxml2-dev", "libxmlsec1-dev", "libffi-dev", "liblzma-dev" ]
    state: latest
  when: ansible_distribution == "Ubuntu" or ansible_distribution == "Debian"

# Ubuntu / Debian
- name: Clone the pyenv repo (Ubuntu / Debian).
  become_user: "{{ user }}"
  git:
    repo: "https://github.com/pyenv/pyenv"
    dest: "{{ home }}/.pyenv"
  when: ansible_distribution == "Ubuntu" or ansible_distribution == "Debian"

- name: Install and enable Python 3.9.5 through pyenv.
  become_user: "{{ user }}"
  shell: "source ~/.zshrc && pyenv install 3.9.5 && pyenv global 3.9.5"
  args:
    executable: "/usr/bin/zsh"
